<!DOCTYPE html>
<html>
<head>
	
	<link rel="stylesheet" href="css_test.css" />
	<link rel="stylesheet" href="leaflet/leaflet.css" />
	<link rel="stylesheet" href="leafletdraw/leaflet.draw.css" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	
	<script src="leaflet/leaflet.js"></script>
	<script src="leafletdraw/leaflet.draw.js"></script>
	//<script src="leafletdraw/leaflet.draw-src.js"></script>
	
	
	
</head>

<body>
	<div id="mapid"></div>
	
	<script>
		//MAP
 		var mymap = L.map('mapid', { 
			center: [58.8534, 5.7317],
			zoom: 13
		});
	  
	  
		 //OpenStreetMap layer
		 var osm_layer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
		     attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
		 }).addTo(mymap); 
		 
		 // //MapBox
// 		 var mapbox_layer = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
// 		     attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
// 		     id: 'Default Public Token',
// 		     accessToken: 'pk.eyJ1IjoibWF0c2VjYyIsImEiOiJjaWx0YnR1bXowMDJndmZtNnFhc2t2OXhuIn0.65XQfz_pB3CNbM5KRTi9OQ'
// 		 });
		 
		 //kartverket topografisk kart
		 var kartverk_topo2_layer = L.tileLayer('http://opencache.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=topo2&zoom={z}&x={x}&y={y}', {
		 		 		     attribution: 'Kartverket'
		 		 		 });
		//kartverket sjøkart kart			 
		 var kartverk_sjohovedkart2_layer = L.tileLayer('http://opencache.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=sjo_hovedkart2&zoom={z}&x={x}&y={y}', {
		 		 		     attribution: 'Kartverket'
		 		 		 });
		 
		 
		 
		 //adds maps to base layer group
		 var baseMaps = {
			 "OpenStreetMap": osm_layer,
			 //"MapBox": mapbox_layer,
			 "Topografisk Norgeskart": kartverk_topo2_layer,
			 "Sea Papirkart": kartverk_sjohovedkart2_layer
		 };
		 
		 
		 
		 //POPUPS
		 var marker = L.marker([58.85, 5.74]);
		 
		 var circle = L.circle([58.8534, 5.7207], 200, {
		     color: 'red',
		     fillColor: '#f03',
		     fillOpacity: 0.5
		 });
		 
		 var polygon = L.polygon([
		     [58.85, 5.73],
		     [58.855, 5.74],
		     [58.859, 5.735]
		 ]); 	 
		 
		 //more popup stuff
		 marker.bindPopup("Jeg er midti byen!");
		 circle.bindPopup("Midt i gata");
		 polygon.bindPopup("Langs jernbanen");
		 
		//adds popups to layer group
		 var markers_group = L.layerGroup([marker, circle, polygon]).addTo(mymap);
		 var overlayMaps = {
		     "popups": markers_group
		 };
		 
		 
		 
		 
		 //Layer control
		L.control.layers(baseMaps, overlayMaps).addTo(mymap);
		
		//LEAFLET.DRAW
		// Initialize the FeatureGroup to store editable layers
		var drawnItems = new L.FeatureGroup();
		mymap.addLayer(drawnItems);

		// Initialize the draw control and pass it the FeatureGroup of editable layers
		var drawControl = new L.Control.Draw({
		    edit: {
		        featureGroup: drawnItems
		    }
		});
		
		mymap.addControl(drawControl);
		
	 
	 mymap.on('draw:created', function (e) {
	     var type = e.layerType,
	         layer = e.layer;

	     if (type === 'marker') {
	         // Do marker specific actions
	     }

	     // Do whatever else you need to. (save to db, add to map etc)
	     drawnItems.addLayer(layer);
	 });

	 mymap.on('draw:edited', function () {
	     // Update db to save latest changes.
	 });

	 mymap.on('draw:deleted', function () {
	     // Update db to save latest changes.
	 });
		
		//LEAFLET.DRAW END 
		
		
		  
		 //EVENTS
		 var popup = L.popup();

		 function onMapClick(e) {
		     popup
		         .setLatLng(e.latlng)
		         .setContent("You clicked the map at " + e.latlng.toString())
		         .openOn(mymap);
		 }
		 mymap.on('click', onMapClick);
		 
		 //find location and set view and zoom
		 mymap.locate({setView: true, maxZoom: 16});
		
		//when location found, show a popup where with accuracy
		 function onLocationFound(e) {
		     var radius = e.accuracy / 2;

		     L.marker(e.latlng).addTo(mymap)
		         .bindPopup("You are within " + radius + " meters from this point").openPopup();

		     L.circle(e.latlng, radius).addTo(mymap);
		 }

		 mymap.on('locationfound', onLocationFound);
		 
		 //if finding location failed, display error message
		 function onLocationError(e) {
		     alert(e.message);
		 }

		 mymap.on('locationerror', onLocationError);
		 
		 //EVENTS END
		 
		
		 
		 
		 	 
	</script>	
</body>
</html>